<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>360&deg; Image</title>
    <meta name="description" content="360&deg; Image - A-Frame" />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.5.1/dist/aframe-look-at-component.min.js"></script>
    <script>
      AFRAME.registerComponent("hotspots", {
        init: function () {
          this.el.addEventListener("reloadspots", function (evt) {
            //get the entire current spot group and scale it to 0
            var currspotgroup = document.getElementById(evt.detail.currspots);
            currspotgroup.setAttribute("scale", "0 0 0");

            //get the entire new spot group and scale it to 1
            var newspotgroup = document.getElementById(evt.detail.newspots);
            newspotgroup.setAttribute("scale", "1 1 1");
          });
        },
      });
      AFRAME.registerComponent("spot", {
        schema: {
          linkto: { type: "string", default: "" },
          spotgroup: { type: "string", default: "" },
        },
        init: function () {
          //add image source of hotspot icon
          this.el.setAttribute("src", "#hotspot");
          //make the icon look at the camera all the time
          this.el.setAttribute("look-at", "#cam");

          var data = this.data;

          this.el.addEventListener("click", function () {
            //set the skybox source to the new image as per the spot
            var sky = document.getElementById("skybox");
            sky.setAttribute("src", data.linkto);

            var spotcomp = document.getElementById("spots");
            var currspots = this.parentElement.getAttribute("id");
            //create event for spots component to change the spots data
            spotcomp.emit("reloadspots", {
              newspots: data.spotgroup,
              currspots: currspots,
            });
          });
        },
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="point1" src="img/photo_studio_01.jpg" />
        <img id="point1" src="img/puydesancy.jpg" />
      </a-assets>

      <a-sky src="#point1"></a-sky>

      <a-entity id="cam" camera position="0 1.6 0" look-controls>
        <a-entity
          cursor="
            fuse:true;
            fuseTimeout:2000"
          geometry="
            primitive:ring;
            radiusInner:0.01;
            radiusOuter:0.02"
          position="0 0 -1.8"
          material="
            shader:flat;
            color:#ff0000"
          animation__mouseenter="
            property:scale;
            to:3 3 3;
            startEvents:mouseenter;
            endEvents:mouseleave;
            dir:reverse;
            dur:2000;
            loop:1"
        >
        </a-entity>
      </a-entity>

      <a-entity
        geometry="primitive: box; size: 1"
        position="6 0 4.3"
        animation="
          dur: 30000;  
          easing: linear; 
          loop: -1;  
          property: rotation;         
          from: 0 0 0;  
          to: 0 360 90"
      ></a-entity>

      <a-text
        font="kelsonsans"
        value="360 image"
        width="6"
        position="-2.5 0.25 -1.5"
        rotation="0 30 0"
        animation="
          dur: 30000;  
          dir: alternate;
          easing: linear; 
          loop: -1;  
          property: position;         
          from: -2.5 0.25 -1.5;  
          to: -2.5 0.65 -1.5"
      ></a-text>
    </a-scene>
  </body>
</html>
