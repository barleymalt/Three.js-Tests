<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Dragoberto's 60s</title>
    <link rel="shortcut icon" href="#" />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/tizzle/aframe-orbit-controls-component/master/dist/aframe-orbit-controls-component.min.js"></script>
    <script>
      let index = 0;

      function changeModel() {
        // Disable all models
        var cam = document.querySelector("#modelIntro");
        cam.setAttribute("visible", false);
        var cam = document.querySelector("#modelMoto");
        cam.setAttribute("visible", false);
        var cam = document.querySelector("#modelDragoberto");
        cam.setAttribute("visible", false);
        var cam = document.querySelector("#modelFamiglia");
        cam.setAttribute("visible", false);
        var cam = document.querySelector("#modelJacopo");
        cam.setAttribute("visible", false);

        if (++index > 4) index = 0;

        // Enable next model
        switch (index) {
          case 0:
            var cam = document.querySelector("#modelIntro");
            cam.setAttribute("visible", true);
            break;
          case 1:
            var cam = document.querySelector("#modelMoto");
            cam.setAttribute("visible", true);
            break;
          case 2:
            var cam = document.querySelector("#modelDragoberto");
            cam.setAttribute("visible", true);
            break;
          case 3:
            var cam = document.querySelector("#modelFamiglia");
            cam.setAttribute("visible", true);
            break;
          case 4:
            var cam = document.querySelector("#modelJacopo");
            cam.setAttribute("visible", true);
            break;
        }
      }

      AFRAME.registerComponent("lambert", {
        schema: {
          color: {
            default: "#fff",
          },
        },
        init: function () {},
        update: function (oldData) {
          let mesh = this.el.getObject3D("mesh");
          if (!mesh) {
            this.el.addEventListener("model-loaded", (e) => {
              this.update.call(this, this.data);
            });
            return;
          }
          this.changeColor(mesh, this.data.color);
        },
        changeColor: function (mesh, color) {
          var material = new THREE.MeshBasicMaterial({
            color: color,
          });

          mesh.traverse(function (node) {
            if (node.type != "Mesh") return;
            let tmp = node.material;
            node.material = material;
            tmp.dispose();
          });
        },
      });
    </script>
    <style>
      #embeddedScene {
        width: 90;
        height: 80vh;
      }
      .a-loader-title {
        color: black;
        font-family: monospace;
      }
    </style>
  </head>

  <body>
    <div id="embeddedScene">
      <a-scene
        embedded
        background="color: #FAFAFA"
        vr-mode-ui="enabled: false"
        loading-screen="dotsColor: red; backgroundColor: black"
      >
        <a-assets>
          <!-- IMAGES -->
          <img id="intro" src="images/berto.JPG" />
          <img id="moto" src="images/moto.JPG" />
          <img id="famiglia" src="images/famiglia.JPG" />
          <img id="jacopo" src="images/jacopo.JPG" />
          <img id="dragoberto" src="images/dragoberto.JPG" />

          <!-- MODELS -->
          <a-asset-item id="skiModel" src="models/ski1.glb"></a-asset-item>
          <a-asset-item id="bike1Model" src="models/bike1.glb"></a-asset-item>
          <a-asset-item id="bike2Model" src="models/bike2.glb"></a-asset-item>
          <a-asset-item id="bike3Model" src="models/bike3.glb"></a-asset-item>
          <a-asset-item id="bike4Model" src="models/bike4.glb"></a-asset-item>
        </a-assets>

        <!-- Orbit Camera -->
        <a-entity
          id="camera"
          camera
          position="0 0 50"
          orbit-controls="
             autoRotate: false;
             target: #camera-target;
             enableDamping: true;
             dampingFactor: 0.25;
             rotateSpeed:0.14;
             minDistance:3;
             maxDistance:15;"
          mouse-cursor="pointerLockEnabled = true"
        >
        </a-entity>

        <!-- INTRO [BERTO] -->
        <a-entity
          id="modelIntro"
          gltf-model="#skiModel"
          lambert="color: #FA824C"
          animation="
          property: object3D.rotation.y;
          from: -30
          to: 30; 
          dur: 10000; 
          dir: alternate;
          easing: easeInOutQuad;
          loop: true"
        >
          <a-entity
            id="camera-target-2"
            position="0 1.3 .7"
            rotation="-10 45 10"
            scale="3 3 3"
          >
            <!-- Text Header -->
            <a-entity
              text="
                value: Tonton Dagoberte
                Zio Dragoberto
                Uncle Dragonbert; 
                color: #5E4955; 
                shader: msdf; 
                font: https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/opensans/OpenSans-Light.json; 
                align: right"
              scale="4 4 4"
              position=".9 0 0.6"
              rotation="0 180 0"
            ></a-entity>

            <!-- Image Container -->
            <a-box
              color="#5BC0BE"
              shader="flat"
              position="0 0 .7"
              scale="2.56806 1.93087 .1"
            >
              <a-image
                src="#intro"
                position="0 0 .54"
                scale=".95 .95 .95"
              ></a-image
            ></a-box>
          </a-entity>
        </a-entity>

        <!-- BIKE ONE [MOTO] -->
        <a-entity
          id="modelMoto"
          gltf-model="#bike1Model"
          visible="false"
          lambert="color: #FA824C"
          animation="
            property: object3D.rotation.y;
            from: -30
            to: 30; 
            dur: 10000; 
            dir: alternate;
            easing: easeInOutQuad;
            loop: true"
        >
          <a-entity
            id="camera-target"
            position="-1.5 2 0.00001"
            rotation="-43 0 10"
          >
            <!-- Text Header -->
            <a-entity
              text="
                value: Dagoberte avec la moto,
                il a fait un beau coup
                de girettes; 
                color: #2D728F; 
                shader: msdf; 
                font: https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/opensans/OpenSans-Light.json; align: right"
              scale="4 4 4"
              position=".9 0 0.6"
              rotation="0 180 0"
            ></a-entity>

            <!-- Image Container -->
            <a-box
              color="#F3DE8A"
              shader="flat"
              position="0 0 .7"
              scale="2.56806 1.93087 .1"
            >
              <a-image src="#moto" position="0 0 .54" scale=".95 .95 .95">
              </a-image
            ></a-box>
          </a-entity>
        </a-entity>

        <!-- BIKE TWO [FAMIGLIA] -->
        <a-entity
          id="modelFamiglia"
          gltf-model="#bike2Model"
          visible="false"
          position="0 0 0"
          rotation="0 0 0"
          scale="1 1 1"
          lambert="color: #C99DA3"
          animation="
          property: object3D.rotation.y;
          from: -30
          to: 30; 
          dur: 10000; 
          dir: alternate;
          easing: easeInOutQuad;
          loop: true"
        >
          <a-entity
            id="camera-target-2"
            position="0 1.3 .7"
            rotation="-23 0 10"
          >
            <!-- Text Header -->
            <a-entity
              text="
                value: Tonton Dagoberte
                Zio Dragoberto
                Uncle Dragonbert; 
                color: #5E4955; 
                shader: msdf; 
                font: https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/opensans/OpenSans-Light.json; 
                align: right"
              scale="4 4 4"
              position=".9 0 0.6"
              rotation="0 180 0"
            ></a-entity>

            <!-- Image Container -->
            <a-box
              color="#5BC0BE"
              shader="flat"
              position="0 0 .7"
              scale="2.56806 1.93087 .1"
            >
              <a-image
                src="#famiglia"
                position="0 0 .54"
                scale=".95 .95 .95"
              ></a-image
            ></a-box>
          </a-entity>
        </a-entity>

        <!-- BIKE THREE [JACOPO] -->
        <a-entity
          id="modelJacopo"
          gltf-model="#bike3Model"
          visible="false"
          position="0 0 0"
          rotation="0 0 0"
          scale="1 1 1"
          lambert="color: #9FD356"
          animation="
            property: object3D.rotation.y;
            from: -30
            to: 30; 
            dur: 10000; 
            dir: alternate;
            easing: easeInOutQuad;
            loop: true"
        >
          <a-entity id="camera-target-2" position="-.8 2 -.7" rotation="0 0 0">
            <!-- Text Header -->
            <a-entity
              text="
              value: Tonton Dagoberte
              Zio Dragoberto
              Uncle Dragonbert; 
              color: #342E37; 
              shader: msdf; 
              font: https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/opensans/OpenSans-Light.json; 
              align: right"
              scale="4 4 4"
              position="1.2 0 0.6"
              rotation="0 180 0"
            ></a-entity>

            <!-- Image Container -->
            <a-box
              color="#3C91E6"
              shader="flat"
              position="0 0 .7"
              scale="2.56806 1.93087 .1"
            >
              <a-image
                src="#jacopo"
                position="0 0 .54"
                scale=".95 .95 .95"
              ></a-image>
              <a-text></a-text>
            </a-box>
          </a-entity>
        </a-entity>

        <!-- BIKE FOUR [DRAGOBERTO] -->
        <a-entity
          id="modelDragoberto"
          gltf-model="#bike4Model"
          visible="false"
          position="0 0 0"
          rotation="0 0 0"
          scale="1 1 1"
          lambert="color: #9AD2CB"
          animation="
            property: object3D.rotation.y;
            from: -30
            to: 30; 
            dur: 10000; 
            dir: alternate;
            easing: easeInOutQuad;
            loop: true"
        >
          <a-entity
            id="camera-target-2"
            position="-2.8 3 -.35"
            rotation="-20 -70 10"
          >
            <!-- Text Header -->
            <a-entity
              text="
              value: Tonton Dagoberte
              Zio Dragoberto
              Uncle Dragonbert; 
              color: #D7EBBA; 
              shader: msdf; 
              font: https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/opensans/OpenSans-Light.json; 
              align: right"
              scale="4 4 4"
              position="1.2 0 0.6"
              rotation="0 180 0"
            ></a-entity>

            <!-- Image Container -->
            <a-box
              color="#472836"
              shader="flat"
              position="0 0 .7"
              scale="2.56806 1.93087 .1"
            >
              <a-image
                src="#dragoberto"
                position="0 0 .54"
                scale=".95 .95 .95"
              ></a-image>
              <a-text></a-text>
            </a-box>
          </a-entity>
        </a-entity>
      </a-scene>
    </div>
    <div><button onclick="changeModel()">Pedalation!</button></div>

    <script>
      var audio = new Audio("audio/TheManInMe.mp3");
      audio.loop = true;
      audio.play();
    </script>
  </body>
</html>
